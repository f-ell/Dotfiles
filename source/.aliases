err() { printf '%s: %s\n' "$1" "$2" 1>&2 }

j() {
  # WARN: uses zsh features
  local fn=j
  [[ -z $1 ]] && { err $fn 'no pattern given!'; return 1; }
  declare -a files=(`fd -d${2:-8} -td -HL | rg -i "$1/?$"`)
  (( ${#files[@]} == 0 )) && { err $fn 'no results found.'; return 1; }
  (( ${#files[@]} == 1 ))\
    && cd ${files[@]}\
    || cd `printf '%s\n' ${files[@]} | zf`
}

owns() {
  local fn=owns program=`command -v $1`
  [[ -z $1 ]] && { err $fn 'no command specified!'; return 1; }
  [[ -z $program ]] \
    && { err $fn "$1 not found!"; return 1; } \
    || pacman -Qo $program
}

pac() {
  local root
  if [[ $1 =~ '[rR]' ]]; then
    root=/usr/bin/doas
    [[ ! -f $root ]] && root=${root%/*}/sudo
    shift
  fi
  [[ $1 =~ '[cC]' ]] && { pacman -Q | wc -l; return 0; }
  $root pacman -$1 ${@:2}
}

ping() {
  /usr/bin/ping -c1 ${1:-archlinux.org}
}

ud2() {
  local fn=ud2 dev=/dev/$1 un
  [[ -b $dev ]] || { err $fn "${1:--} is not a valid blockdev."; return 1; }
  [[ -n `udisksctl info -b $dev | grep -oP '^\s*MountPoints:\s+\K.*$'` ]] \
    && un=un
  udisksctl ${un}mount -b $dev
}

wnvm() {
  local fn=wnvm root=pom.xml mvnw=./mvnw
  pushd $PWD &>/dev/null
  until [[ $PWD == / || -f ./$root ]]; do cd ..; done
  [[ $PWD == / ]]\
    && { err $fn 'no maven root found.'; popd &>/dev/null; return 1; }
  [[ -f ./mvnw ]] && ./mvnw $@ || mvn $@
  popd &>/dev/null
}


alias -- -='cd -'
alias code='code --extensions-dir '$XDG_DATA_HOME'/vscode'
alias dots='cd $HOME/Git/Dotfiles/'
alias e='exa'
alias e1='exa -1'
alias ed='exa -ld'
alias el='exa -la'
alias ex='exec $SHELL'
alias feh='feh --no-fehbg'
alias gl='glow -p'
alias hist='tail -10 <(history)'
alias scripts='cd $HOME/Git/Scripts/'
alias v=$EDITOR
alias va=$EDITOR' $HOME/.aliases && . $HOME/.aliases'
alias yeet='doas pacman -Qtdq | doas pacman -Rns -'
alias xo='xdg-open'
alias zt='zathura --fork'


sconf='$HOME/.config/bspwm/sxhkdrc.bspwm $HOME/.config/sxhkd/sxhkdrc.'
if [[ $MACHINE = DT ]]; then
  sconf="${sconf}dt"
  dconf=''
else
  sconf="${sconf}lt"
  dconf='-conf $HOME/.config/dunst/dunstrc.lt' 
  alias netstart='rfkill unblock wifi; doas systemctl start NetworkManager'
  alias netstop='nmcli d disconnect wlan0; doas systemctl stop NetworkManager; rfkill block wifi'
fi
alias dcr="pkill dunst; dunst $dconf &; disown dunst"
alias scr="pkill sxhkd; sxhkd $sconf &; disown sxhkd"
unset {d,s}conf

[[ -f $HOME/.aliases_novcs ]] && . $HOME/.aliases_novcs
