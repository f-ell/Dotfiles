#!/bin/sh
# Dependencies: kitty, bspc (duh), grep, tr, wmctrl
# Scratchpads should be hidden, sticky, and floating

Name=$1
case $Name in
  File) Program="ranger $HOME"; break;;
  Calc) Program='bc -ql'; break;;
  *)      exit 1;;
esac

# visible scratchpad (if any)
Visible=`bspc query -N -n .\!hidden.sticky.floating | tr [:upper:] [:lower:]`

# target scratchpad window id
TargetWid="`wmctrl -l | grep SPad$Name`"

# run scratchpad if not running; sleep required because wmctrl is slow
[ -z "$TargetWid" ] && { (kitty -T "SPad$Name" $Program &); sleep 0.3; \
                          TargetWid="`wmctrl -l | grep $Name`"; }

TargetWid=${TargetWid%% *}

# toggle visible if it's not the target (-> no overlapping scratchpads)
[ -n "$Visible" ] && [ $Visible != $TargetWid ] \
  && bspc node $Visible -g hidden -f

# toggle target scratchpad. Parameter expansion to prevent unwanted window
# toggling with potential script errors
bspc node ${TargetWid:-0} -g hidden -d focused -f

